#! /usr/bin/env python

import os
import subprocess
import sys

MODULES = []


def main(args):
    ''' Load modules then launch salome
    '''
    if MODULES:
        env_modules = MODULES[:]
        env_modules_option = "--with-env-modules="
        env_modules_l = [x for x in args if x.startswith(env_modules_option)]
        if env_modules_l:
          env_modules += env_modules_l[-1][len(env_modules_option):].split(',')
          args = [x for x in args if not x.startswith(env_modules_option)]
        env_modules_option += "%s" % ','.join(env_modules)
        args.append(env_modules_option)

    currentPath = os.path.realpath(os.path.dirname(os.path.abspath(__file__)))
    proc = subprocess.Popen(['./.salome_run'] + args,
                            close_fds=True, cwd=currentPath)
    out, err = proc.communicate()
    return out, err, proc.returncode

if __name__ == "__main__":
    main(sys.argv[1:])
#

